<!DOCTYPE html>
<html>
<head>
  <!-- set the encoding of your site -->
  <meta charset="utf-8">
  <!-- set the viewport width and initial-scale on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KAAFI | Account</title>
  <!-- include the site stylesheet -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:700' rel='stylesheet' type='text/css'>
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/fonts.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/animate.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/color/color.css">

    <!-- inject:css -->
    <link rel="stylesheet" href="assets/css/vendors/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/vendors/meanmenu.min.css">
    <link rel="stylesheet" href="assets/css/vendors/slick.css">
    <link rel="stylesheet" href="assets/css/vendors/slick-theme.css">
    <link rel="stylesheet" href="assets/css/vendors/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/vendors/nice-select.css">
    <link rel="stylesheet" href="assets/css/vendors/jquery.fancybox.min.css">
    <link rel="stylesheet" href="assets/css/vendors/jquery.nstSlider.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- endinject -->

    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
  <!-- Page Loader -->
  <div id="pre-loader" class="loader-container">
    <div class="loader">
      <img src="images/svg/rings.svg" alt="loader">
    </div>
  </div>
  <!-- main container of all the page elements -->
  <div id="wrapper">
    <!-- header of the page -->
    <header id="header" class="sticky-header">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <!-- logo of the page -->
            <div class="logo">
              <a href="home.html"><img src="images/kaafi-logo.png" alt="KAAFI"></a>
            </div>
            <div class="nav-holder">
              <a href="#" class="nav-opener"><span>menu</span></a>
              <!-- nav of the page -->
              <nav id="nav">
                <ul class="list-unstyled">
                  <li>
                    <a href="home.html">home</a>
                  </li>
                  <li class="active mega-drop">
                    <a href="#">shop</a>
                    <div class="drop-holder">
                      <div class="coll">
                        <strong class="title">SHOP PAGE</strong>
                        <ul class="list-unstyled">
                          <li><a href="category-page.html">Shop</a></li>
                          <li><a href="shoping-cart.html">Shoping Cart</a></li>
                          <li><a href="shoping-cart.html">Checkout</a></li>
                          <li><a href="login.html">Wishlist</a></li>
                          <li><a href="login.html">Login</a></li>
                        </ul>
                      </div>
                      <div class="coll">
                        <strong class="title">PRODUCTS</strong>
                        <ul class="list-unstyled">
                          <li><a href="#">Basic Products</a></li>
                          <li><a href="#">Simple Products</a></li>
                          <li><a href="#">Varieble Products</a></li>
                          <li><a href="#">Simple Products</a></li>
                        </ul>
                      </div>
                      <div class="coll coll-2">
                        <strong class="title">LAST CHANCE</strong>
                        <div class="offer-txt">
                          <span class="txt">sale</span>
                          <span class="offer-sale">40%</span>
                          <span class="txt-about">Pharetra, erat sed <br>fermentum feugiat, velit <br>mauris egestas quam. </span>
                          <a href="#" class="btn-more">Read more <i class="icon-right-arrow"></i></a>
                          <div class="img-holder">
                            <img src="http://placehold.it/150x100" alt="image description">
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a href="blog.html">blog</a>
                    <!-- <ul class="list-unstyled drop">
                      <li><a href="blog.html">Blog</a></li>
                      <li><a href="blog-detail.html">Single Post</a></li>
                    </ul> -->
                  </li>
                  <li><a href="about-us.html">about</a></li>
                  <li><a href="contact-us.html">Contact</a></li>
                </ul>
              </nav>
              <div class="align-right">
                <!-- social-networks of the page -->
                <ul class="list-unstyled icon-list">
                  <li>
                    <a href="register.html"><img src="images/user.png" alt="images description"></a>
                  </li>
                  <li class="cart-box hidden-xs">
                    <a class="cart-opener opener-icons" href="#">
                      <i class="icon-cart"></i>
                      <span class="cart-num">2</span>
                    </a>
                    <div class="cart-drop">
                      <div class="cart-holder">
                        <strong class="main-title">You have <i>4 items</i> in your card</strong>
                        <ul class="cart-list list-unstyled">
                          <li>
                            <div class="image">
                              <a href="#"><img alt="Image Description" src="images/img02.jpg"></a>
                            </div>
                            <div class="description">
                              <span class="product-name"><a href="#">Kenneth Jay Lane</a></span>
                              <span class="price">₹230</span>
                            </div>
                            <a class="icon-close" href="#"></a>
                          </li>
                          <li>
                            <div class="image">
                              <a href="#"><img alt="Image Description" src="images/img02.jpg"></a>
                            </div>
                            <div class="description">
                              <span class="product-name"><a href="#">Lavin lady</a></span>
                              <span class="price">₹173</span>
                            </div>
                            <a class="icon-close" href="#"></a>
                          </li>
                        </ul>
                        <div class="total-price-area">
                          <span class="title-text">Total</span>
                          <span class="price">₹403</span>
                        </div>
                        <span class="cart">View card</span>
                        <a href="#" class="btn">checkout</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a class="btn-search" href="#"><i class="icon-search"></i></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Search Popup of the page -->
    <div class="search-popup">
      <div class="holder">
        <div class="col">
          <div class="block-holder">
            <a href="#" class="close-btn"><i class="icon-close"></i></a>
            <form action="#" class="submit-form">
              <fieldset>
                <label for="search" class="icon-search"></label>
                <input type="search" id="search">
              </fieldset>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- contain main informative part of the site -->
      <main id="main" role="main">
          <section class="banner" style="background-image: url(images/1920category.jpg);">
            <span class="sale-percent">SALE OF 50%</span>
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                  <div class="caption">
                    <h1 class="main-heading heading-1">Accounts</h1>
                    <ul class="list-unstyled breadcrumbs">
                      <li><a href="home.html">Home</a></li>
                      <li><a href="login.html">Login</a></li>
                      <li>Accounts</li>
                    </ul>
                  </div>
              </div>
            </div>
          </div>
          <span class="year">TRENDS OF THE YEAR</span>
        </section>
                <!-- My Account Area -->
                <div class="tm-section tm-my-account-area bg-white tm-padding-section">
                  <div class="container">
                      <div class="tm-myaccount">
                          <ul class="nav tm-tabgroup" id="account" role="tablist">
                              <li class="nav-item">
                                  <a class="nav-link active" id="account-dashboard-tab" data-toggle="tab"
                                      href="#account-dashboard" role="tab" aria-controls="account-dashboard"
                                      aria-selected="true">Dashboard</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link" id="account-orders-tab" data-toggle="tab" href="#account-orders"
                                      role="tab" aria-controls="account-orders" aria-selected="false">Orders</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link" id="account-address-tab" data-toggle="tab" href="#account-address"
                                      role="tab" aria-controls="account-address" aria-selected="false">Address</a>
                              </li>
                              <!-- <li class="nav-item">
                                  <a class="nav-link" id="account-acdetails-tab" data-toggle="tab"
                                      href="#account-acdetails" role="tab" aria-controls="account-acdetails"
                                      aria-selected="false">Account Details</a>
                              </li> -->
                              <li class="nav-item">
                                  <a class="nav-link" id="account-logout-tab" href="login-register.html" role="tab"
                                      aria-controls="account-address" aria-selected="false">Logout</a>
                              </li>
                          </ul>
  
                          <div class="tab-content" id="account-ontent">
                              <div class="tab-pane fade show active" id="account-dashboard" role="tabpanel"
                                  aria-labelledby="account-dashboard-tab">
                                  <div class="tm-myaccount-dashboard">
                                      <!-- <p>Hello <b>William Bean</b> (not <b>William Bean</b>? <a
                                              href="login-register.html">Log
                                              out</a>)</p>
                                      <p>From your account dashboard you can view your recent orders, manage your
                                          shipping and billing addresses, and edit your password and account details.</p> -->

                                          <div id="user-info">
                                            <p>Hello <b><span id="user-name"></span></b></p>

                                            <div style="height: 150px; width: 150px;" id="profile-picture">
                                              <img id="user-avatar" src="" alt="Profile Picture">
                                          </div>
                                         <span id="user-name"></span>
                                            <p>Email-: <span id="user-email"></span></p>
                                           
                                        </div>
                                  </div>
                              </div>
                              <div class="tab-pane fade" id="account-orders" role="tabpanel"
                                  aria-labelledby="account-orders-tab">
                                  <div class="tm-myaccount-orders">
                                      <div class="table-responsive" id="account-orders-details">
                                          <!-- <table class="table table-bordered mb-0" >
                                              <thead>
                                                  <tr>
                                                      <th class="tm-myaccount-orders-col-id">ORDER ID</th>
                                                      <th class="tm-myaccount-orders-col-date">DATE</th>
                                                      <th class="tm-myaccount-orders-col-status">STATUS</th>
                                                      <th class="tm-myaccount-orders-col-total">TOTAL</th>
                                                      <th class="tm-myaccount-orders-col-view">VIEW</th>
                                                  </tr>
                                              </thead>
                                              <tbody >
                                                  <tr>
                                                      <td>#12345</td>
                                                      <td>30 December 2018</td>
                                                      <td>On Hold</td>
                                                      <td>$132.00 for 2 items</td>
                                                      <td><a href="#" class="tm-button tm-button-small">View</a>
                                                      </td>
                                                  </tr>
                                              </tbody>
                                          </table> -->
                                      </div>
                                  </div>
                              </div>
                              <div class="tab-pane fade" id="account-address" role="tabpanel"
                                  aria-labelledby="account-address-tab">
                                  <div class="tm-myaccount-address">
                                      <p><b>your currunt Shipping Adress.</b></p>
                                      <div class="row">
                                          <div class="col-lg-6 col-md-6" id="additional-order-details">
                                             
                                          </div>
                                         
                                      </div>
                                  </div>
                              </div>
                              <!-- <div class="tab-pane fade" id="account-acdetails" role="tabpanel"
                                  aria-labelledby="account-acdetails-tab">
                                  <div class="tm-myaccount-acdetails">
                                      <form action="#" class="tm-form tm-form-bordered">
                                          <h4>Account Details</h4>
                                          <div class="tm-form-inner">
                                              <div class="tm-form-field tm-form-fieldhalf">
                                                  <label for="acdetails-firstname">First name</label>
                                                  <input type="text" id="acdetails-firstname">
                                              </div>
                                              <div class="tm-form-field tm-form-fieldhalf">
                                                  <label for="acdetails-lastname">Last name</label>
                                                  <input type="text" id="acdetails-lastname">
                                              </div>
                                              <div class="tm-form-field">
                                                  <label for="acdetails-displayname">Dispaly name</label>
                                                  <input type="text" id="acdetails-displayname">
                                              </div>
                                              <div class="tm-form-field">
                                                  <label for="acdetails-email">Email address</label>
                                                  <input type="email" id="acdetails-email">
                                              </div>
                                              <div class="tm-form-field">
                                                  <label for="acdetails-password">Old password</label>
                                                  <input type="password" id="acdetails-password">
                                              </div>
                                              <div class="tm-form-field">
                                                  <label for="acdetails-newpassword">New password</label>
                                                  <input type="password" id="acdetails-newpassword">
                                              </div>
                                              <div class="tm-form-field">
                                                  <label for="acdetails-confirmpass">Confirm password</label>
                                                  <input type="password" id="acdetails-confirmpass">
                                              </div>
                                              <div class="tm-form-field">
                                                  <input type="checkbox" name="acdetails-agreeterms"
                                                      id="acdetails-agreeterms">
                                                  <label for="acdetails-agreeterms">I have read and agree to the Privacy
                                                      Policy</label>
                                              </div>
                                              <div class="tm-form-field">
                                                  <button type="submit" class="tm-button">Save Changes</button>
                                              </div>
                                          </div>
                                      </form>
                                  </div>
                              </div> -->
                          </div>
                      </div>
                  </div>
              </div>
        </main>
              <!--// My Account Area -->
  
    <!-- footer of the Page -->
    <footer id="footer" class="wow fadeInUp" data-wow-delay="0.4s">
      <span class="free-ship">FREE SHIPPING</span>
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-sm-4 col-lg-4 txt-holder">
            <div class="footer-logo">
              <a href="home.html">kaafi</a>
            </div>
            <p>Where regal elegance <br>and impeccable craftsmanship <br>unite to adorn you with <br> exquisite treasures fit for royalty.</p>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-3">
            <h3>contact us</h3>
            <!-- Contact of the page -->
            <ul class="list-unstyled contact-info">
              <li><i class="icon icon-location"></i><address>Shastri Nagar, Vasai</address></li>
              <li><i class="icon icon-email"></i><a class="txt" href="#">kaafisupport.com</a></li>
              <li><i class="icon icon-phone"></i><a class="txt" href="#">+91 84598 84598</a></li>
              <li><i class="icon icon-phone"></i><a class="txt" href="#">+91 98745 98745</li>
            </ul>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-5">
            <h3>Kaafi Socials</h3>
            <!-- Instagram of the page -->
            <ul class="list-unstyled instagram-list">
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
            </ul>
          </div>
        </div>
      </div>
      <span class="support">24H SUPPORT</span>
    </footer>
    <!-- Back Top of the page -->
    <span id="back-top" class="arrow_carrot-up"></span>
  </div>
  <script>
    // Function to fetch and display user profile
    async function fetchUserProfile() {
        const accessToken = localStorage.getItem('access_token');

        // Replace 'http://localhost:5000' with the URL of your user profile endpoint
        const profileUrl = 'http://localhost:5000/api/users/profile';

        try {
            const response = await fetch(profileUrl, {
                headers: {
                    Authorization: `Bearer ${accessToken}`,
                },
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const userData = await response.json();
            displayUserProfile(userData);
        } catch (error) {
            console.error('Error fetching user profile:', error);
        }
    }

    function displayUserProfile(userData) {
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const userAvatar = document.getElementById('user-avatar');

        userName.textContent = userData.username;
        userEmail.textContent = userData.email;
        userAvatar.src = userData.avatar;
    }

    // Call the function to fetch and display the user profile
    fetchUserProfile();
//fetch users orders

function handleFetchError(type, error) {
        console.error(`Error fetching ${type}:`, error);
        // Handle the error as needed, e.g., display an error message to the user.
      }

      async function fetchUserOrders() {
        try {
          const accessToken = localStorage.getItem("access_token");

          if (!accessToken) {
            throw new Error("Access token not found.");
          }

          const userId = jwt_decode(accessToken).id;
          const ordersUrl = `http://localhost:5000/api/orders/find/${userId}`;
          const response = await fetch(ordersUrl, {
            headers: {
              Authorization: `Bearer ${accessToken}`,
            },
          });

          if (!response.ok) {
            throw new Error("Network response was not OK");
          }

          const orderData = await response.json();
          displayUserOrders(orderData);
        } catch (error) {
          handleFetchError("user orders", error);
        }
      }



//             function displayUserOrders(orderData) {
//   const orderDetailsContainer = document.getElementById("account-orders-details");
//   const additionalOrderDetailsContainer = document.getElementById("additional-order-details");

//   orderDetailsContainer.innerHTML = "";
//   additionalOrderDetailsContainer.innerHTML = ""; // Clear previous content

//   for (const order of orderData) {
//     const orderElement = document.createElement("div");

//     orderElement.innerHTML = `
// <table class="table table-bordered mb-0" >
//                                               <thead>
//                                                   <tr>
//                                                       <th class="tm-myaccount-orders-col-id">ORDER ID</th>
//                                                       <th class="tm-myaccount-orders-col-date">DATE AND TIME</th>
//                                                        <th class="tm-myaccount-orders-col-status">STATUS</th>
//                                                        <th class="tm-myaccount-orders-col-total">TOTAL</th>
//                                                        <th class="tm-myaccount-orders-col-view">VIEW</th>
//                                                    </tr>
//                                                </thead>
//                                                <tbody >
//                                                    <tr>
//                                                        <td>${order._id}</td>
//                                                        <td>${new Date(order.createdAt).toLocaleString()}</td>
//                                                        <td>On Hold</td>
//                                                        <td>${order.amount.toFixed(2)}</td>
//                                                     <td><a href="#" class="tm-button tm-button-small">View</a>
//                                                        </td>
//                                                    </tr>
//                                                </tbody>
//                                            </table>
//     `;

//     orderDetailsContainer.appendChild(orderElement);

   

//     // Create content for the additional order details
//     const additionalOrderElement = document.createElement("div");
//     additionalOrderElement.innerHTML = `
//     <div class="tm-myaccount-address-billing">
//                                                   <a href="#" class="edit-button">Edit</a>
//                                                   <h3>Shipping Address</h3>
//                                                   <address>
//                                                     ${order.address.city}
//                                                   </address>
//                                               </div>
//     `;
// console.log(order.address);
//     additionalOrderDetailsContainer.appendChild(additionalOrderElement);
//   }
// }


function displayUserOrders(orderData) {
  const orderDetailsContainer = document.getElementById("account-orders-details");
  const additionalOrderDetailsContainer = document.getElementById("additional-order-details");

  orderDetailsContainer.innerHTML = "";
  additionalOrderDetailsContainer.innerHTML = ""; // Clear previous content

  // Display all orders
  for (const order of orderData) {
    // Create content for the order details
    const orderElement = document.createElement("div");

    orderElement.innerHTML = `
      <table class="table table-bordered mb-0">
        <thead>
          <tr>
            <th class="tm-myaccount-orders-col-id">ORDER ID</th>
            <th class="tm-myaccount-orders-col-date">DATE AND TIME</th>
            <th class="tm-myaccount-orders-col-status">STATUS</th>
            <th class="tm-myaccount-orders-col-total">TOTAL</th>
            <th class="tm-myaccount-orders-col-view">VIEW</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>${order._id}</td>
            <td>${new Date(order.createdAt).toLocaleString()}</td>
            <td>On Hold</td>
            <td>${order.amount.toFixed(2)}</td>
            <td><a href="#" class="tm-button tm-button-small">View</a></td>
          </tr>
        </tbody>
      </table>
    `;

    orderDetailsContainer.appendChild(orderElement);

    // Create content for the additional order details (show only for the first order)
    if (order === orderData[0]) {
      const additionalOrderElement = document.createElement("div");
      additionalOrderElement.innerHTML = `
        <div class="tm-myaccount-address-billing">
         
          <h3>Shipping Address</h3>
          <address>
            ${order.address && order.address.city ? order.address.city : ''}
            District: ${order.address && order.address.district ? order.address.district : ''}
         state: ${order.address && order.address.state ? order.address.state : ''}
          </address>
        </div>
      `;
// edit button (befor   <h3>Shipping Address</h3>) incase of use  <a href="#" class="edit-button">Edit</a>
      additionalOrderDetailsContainer.appendChild(additionalOrderElement);
    }
  }
}

      
      fetchUserOrders();


   
</script>



  <!-- include jQuery -->
  <script src="js/jquery-1.11.3.min.js"></script>
  <!-- include jQuery -->
  <script src="js/plugins.js"></script>
  <!-- include jQuery -->
  <script src="js/jquery.main.js"></script>

      <!-- inject:js -->
      <script src="assets/js/vendors/modernizr-3.7.1.min.js"></script>
      <script src="assets/js/vendors/jquery-3.3.1.min.js"></script>
      <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
      <script src="assets/js/vendors/jquery.meanmenu.min.js"></script>
      <script src="assets/js/vendors/slick.min.js"></script>
      <script src="assets/js/vendors/jquery.nice-select.js"></script>
      <script src="assets/js/vendors/jquery.countdown.min.js"></script>
      <script src="assets/js/vendors/jquery.ajaxchimp.min.js"></script>
      <script src="assets/js/vendors/jquery.fancybox.min.js"></script>
      <script src="assets/js/vendors/imagesloaded.pkgd.min.js"></script>
      <script src="assets/js/vendors/isotope.pkgd.min.js"></script>
      <script src="assets/js/vendors/instafeed.min.js"></script>
      <script src="assets/js/vendors/jquery.nstslider.min.js"></script>
      <script src="assets/js/vendors/ScrollMagic.min.js"></script>
      <script src="assets/js/main.js"></script>
      <!-- endinject -->
  
</body>
</html>