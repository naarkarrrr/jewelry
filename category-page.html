<!DOCTYPE html>
<html>
<head>
  <!-- set the encoding of your site -->
  <meta charset="utf-8">
  <!-- set the viewport width and initial-scale on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KAAFI | Shop</title>
  <!-- include the site stylesheet -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:700' rel='stylesheet' type='text/css'>
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/fonts.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="css/animate.css">
  <!-- include the site stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- include the site stylesheet -->

  <link rel="stylesheet" href="css/dropdown.css">
  <link rel="stylesheet" href="css/color/color.css">

<style>


  /* Style for the modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }


.grid-container{
 padding: 5px;
 display: grid;
  grid-template-columns: auto auto auto auto;
 gap: 1%;
}

.img-responsive{
  max-width: 330px;
}

.quantity-input{
  width: 50px;
}

 
</style>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
  <!-- Page Loader -->
  <div id="pre-loader" class="loader-container">
    <div class="loader">
      <img src="images/svg/rings.svg" alt="loader">
    </div>
  </div>
  <!-- main container of all the page elements -->
  <div id="wrapper">
    <!-- header of the page -->
    <header id="header" class="sticky-header">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <!-- logo of the page -->
            <div class="logo">
              <a href="home.html"><img src="images/kaafi-logo.png" alt="KAAFI"></a>
            </div>
            <div class="nav-holder">
              <a href="#" class="nav-opener"><span>menu</span></a>
              <!-- nav of the page -->
              <nav id="nav">
                <ul class="list-unstyled">
                  <li>
                    <a href="home.html">home</a>
                  </li>
                  <li class="active mega-drop">
                    <a href="#">shop</a>
                    <div class="drop-holder">
                      <div class="coll">
                        <strong class="title">SHOP PAGE</strong>
                        <ul class="list-unstyled">
                          <li><a href="category-page.html">Shop</a></li>
                          <li><a href="shoping-cart.html">Shoping Cart</a></li>
                          <li><a href="shoping-cart.html">Checkout</a></li>
                          <li><a href="login.html">Wishlist</a></li>
                          <li><a href="login.html">Login</a></li>
                        </ul>
                      </div>
                      <div class="coll">
                        <strong class="title">PRODUCTS</strong>
                        <ul class="list-unstyled">
                          <li><a href="#">Basic Products</a></li>
                          <li><a href="#">Simple Products</a></li>
                          <li><a href="#">Varieble Products</a></li>
                          <li><a href="#">Simple Products</a></li>
                        </ul>
                      </div>
                      <div class="coll coll-2">
                        <strong class="title">LAST CHANCE</strong>
                        <div class="offer-txt">
                          <span class="txt">sale</span>
                          <span class="offer-sale">40%</span>
                          <span class="txt-about">Pharetra, erat sed <br>fermentum feugiat, velit <br>mauris egestas quam. </span>
                          <a href="#" class="btn-more">Read more <i class="icon-right-arrow"></i></a>
                          <div class="img-holder">
                            <img src="http://placehold.it/150x100" alt="image description">
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a href="blog.html">blog</a>
                    <!-- <ul class="list-unstyled drop">
                      <li><a href="blog.html">Blog</a></li>
                      <li><a href="blog-detail.html">Single Post</a></li>
                    </ul> -->
                  </li>
                  <li><a href="about-us.html">about</a></li>
                  <li><a href="contact-us.html">Contact</a></li>
                </ul>
              </nav>
              <div class="align-right">
                <!-- social-networks of the page -->
                <ul class="list-unstyled icon-list">
                  <!-- <li class="dropdown">
                    <img class="dropdown-btn" src="images/user.png" alt="images description">
                             <div class="dropdown-content">
                               <a href="login.html">Login</a>
                               <button id="logoutButton">Logout</button>
                               <a href="#">Profile</a>
                               <a href="register.html">Register</a>
                             </div>
                         </li> -->
                         <li class="dropdown" id="userDropdown">
                          <img class="dropdown-btn" src="images/user.png" alt="images description">
                          <div class="dropdown-content">
                              <a id="loginLink" href="login.html">Login</a>
                              <button id="logoutButton">Logout</button>
                              <a id="profileLink" href="#">Profile</a>
                              <a id="registerLink" href="register.html">Register</a>
                          </div>
                      </li>

                  <li class="cart-box hidden-xs">
                    <a class="cart-opener opener-icons" href="#">
                      <i class="icon-cart"></i>
                      <span class="cart-num">2</span>
                    </a>
                    <div class="cart-drop">
                      <div class="cart-holder">
                        <strong class="main-title">You have <i>4 items</i> in your card</strong>
                        <ul class="cart-list list-unstyled">
                          <li>
                            <div class="image">
                              <a href="#"><img alt="Image Description" src="images/img02.jpg"></a>
                            </div>
                            <div class="description">
                              <span class="product-name"><a href="#">Kenneth Jay Lane</a></span>
                              <span class="price">₹230</span>
                            </div>
                            <a class="icon-close" href="#"></a>
                          </li>
                          <li>
                            <div class="image">
                              <a href="#"><img alt="Image Description" src="images/img02.jpg"></a>
                            </div>
                            <div class="description">
                              <span class="product-name"><a href="#">Lavin lady</a></span>
                              <span class="price">₹173</span>
                            </div>
                            <a class="icon-close" href="#"></a>
                          </li>
                        </ul>
                        <div class="total-price-area">
                          <span class="title-text">Total</span>
                          <span class="price">₹403</span>
                        </div>
                        <span class="cart">View card</span>
                        <a href="#" class="btn">checkout</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a class="btn-search" href="#"><i class="icon-search"></i></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Search Popup of the page -->
    <div class="search-popup">
      <div class="holder">
        <div class="col">
          <div class="block-holder">
            <a href="#" class="close-btn"><i class="icon-close"></i></a>
            <form action="#" class="submit-form">
              <fieldset>
                <label for="search" class="icon-search"></label>
                <input type="search" placeholder="Search">
              </fieldset>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- contain main informative part of the site -->
    <main id="main" role="main">
      <!-- main-banner of the page -->
      <section class="banner wow fadeInUp" data-wow-delay="0.4s" style="background-image: url(images/1920category.jpg);">
        <span class="sale-percent">SALE OF 50%</span>
        <div class="container">
          <div class="row">
            <div class="col-xs-12">
                <div class="caption">
                  <h1 class="main-heading">Shop</h1>
                  <ul class="list-unstyled breadcrumbs">
                    <li><a href="home.html">Home</a></li>
                    <li>shop</li>
                  </ul>
                </div>
            </div>
          </div>
        </div>
        <span class="year">TRENDS OF THE YEAR</span>
      </section>
      <!-- product-section of the page -->
      <section class="product-sec wow fadeInUp" data-wow-delay="0.4s">
        <div class="container">
          <div class="row">
            <div class="col-xs-12">
              <ul class="list-unstyled filter-list">
                <li><input type="checkbox" class="category-checkbox" value="Charms"> Charms</li>
                <li><input type="checkbox" class="category-checkbox" value="Rings"> Rings</li>
                <li><input type="checkbox" class="category-checkbox" value="Pendants"> Pendants</li>
                <li><input type="checkbox" class="category-checkbox" value="Rings"> Rings</li>
                <li><input type="checkbox" class="category-checkbox" value="Women's"> Women's</li>
                <li>  <input type="checkbox" class="category-checkbox" value="Men's"> Men’s</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="holder grid-container" id="product-list">
        
         
        </div>
        <div id="productModal" class="modal">
          <div class="modal-content">
            <span class="close" onclick="document.getElementById('productModal').style.display='none'">&times;</span>

            <!-- Product details will be dynamically inserted here -->
          </div>
        </div>
        

      </section>
    </main>
    <!-- footer of the Page -->
    <footer id="footer" class="wow fadeInUp" data-wow-delay="0.4s">
      <span class="free-ship">FREE SHIPPING</span>
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-sm-4 col-lg-4 txt-holder">
            <div class="footer-logo">
              <a href="home.html">kaafi</a>
            </div>
            <p>Where regal elegance <br>and impeccable craftsmanship <br>unite to adorn you with <br> exquisite treasures fit for royalty.</p>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-3">
            <h3>contact us</h3>
            <!-- Contact of the page -->
            <ul class="list-unstyled contact-info">
              <li><i class="icon icon-location"></i><address>Shastri Nagar, Vasai</address></li>
              <li><i class="icon icon-email"></i><a class="txt" href="#">kaafisupport.com</a></li>
              <li><i class="icon icon-phone"></i><a class="txt" href="#">+91 84598 84598</a></li>
              <li><i class="icon icon-phone"></i><a class="txt" href="#">+91 98745 98745</li>
            </ul>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-5">
            <h3>intagram feed</h3>
            <!-- Instagram of the page -->
            <ul class="list-unstyled instagram-list">
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
              <li><a href="#"><img src="http://placehold.it/95x70" alt="image description"></a></li>
            </ul>
          </div>
        </div>
      </div>
      <span class="support">24H SUPPORT</span>
    </footer>
    <!-- Back Top of the page -->
    <span id="back-top" class="arrow_carrot-up"></span>
  </div>
<!-- contant script  -->

<script>
  // Function to extract user ID from the access token
  function getUserIdFromToken(token) {
      const decodedToken = jwt_decode(token);
      return decodedToken.sub; // Adjust this based on your token structure
  }


async function addToCart(event) {
const productId = event.target.getAttribute('data-product-id');
const accessToken = localStorage.getItem('access_token');
const decodedToken = jwt_decode(accessToken);

if (!accessToken) {
    console.error('Access token is missing or invalid.');
    return;
}

const userId = decodedToken.id; // Adjust this based on the structure of your token
console.log('Extracted User ID:', userId);

const url = `http://localhost:5000/api/carts/${userId}`; // Check the constructed URL
console.log('Request URL:', url);

const quantityInput = event.target.parentNode.querySelector('.quantity-input');
const quantity = quantityInput.value;

const requestBody = {
    userId: userId,
    productId: productId,
    quantity: quantity,
};

console.log('Request Body:', requestBody);

try {
    const response = await fetch(url, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${accessToken}`,
        },
        body: JSON.stringify(requestBody),
    });

    if (!response.ok) {
        throw new Error('Network response was not ok');
    }

    const data = await response.json();
    alert('Product added to the cart successfully!');
} catch (error) {

    console.error('Error adding product to the cart:', error);
    // Handle the error, e.g., display an error message to the user.
    window.location.href = 'login.html';
}
}




  // Attach the "addToCart" function to the document's click event
  document.addEventListener('click', (event) => {
      if (event.target.classList.contains('add-to-cart-button')) {
          addToCart(event);
      }
  });

  async function fetchAndDisplayProducts() {
      try {
          const response = await fetch('http://localhost:5000/api/products/all');
          const products = await response.json();
          const productContainer = document.getElementById('product-list');
          const categoryCheckboxes = document.querySelectorAll('.category-checkbox');

          function productMatchesCategories(product, selectedCategories) {
              if (selectedCategories.length === 0) {
                  return true;
              }
              return selectedCategories.some(category => product.categories.includes(category));
          }

          function filterProducts() {
              const selectedCategories = Array.from(categoryCheckboxes)
                  .filter(checkbox => checkbox.checked)
                  .map(checkbox => checkbox.value);

              productContainer.innerHTML = '';

              products.forEach(product => {
                  if (productMatchesCategories(product, selectedCategories)) {
                      const productDiv = document.createElement('div');
                      productDiv.className = 'product-card';
                      productDiv.innerHTML = `
                    
                      <div class="product-block">
            <div class="over ">
              <div class="align-left">
                <strong class="title-name">${product.title}</strong>
                <strong class="price">₹${product.price.toFixed(2)}</strong>
              </div>
              <a href="#" class="like">
                <i class="icon-favorite"></i>
                23
              </a>
              <button class="add-to-cart-button" data-product-id="${product._id}">Add to Cart</button>
                          <input type="number" class="quantity-input" value="1" min="1">
            </div>
            <img class="img-responsive" alt="image description" src="${product.img}">
            
          </div>`
         ;
                      productContainer.appendChild(productDiv);
                  }
              });
          }

          categoryCheckboxes.forEach(checkbox => {
              checkbox.addEventListener('change', filterProducts);
          });

          filterProducts(); // Call the function to initially display products
      } catch (error) {
          console.error('Error fetching and displaying products:', error);
      }
  }


  function createProductDetailsModal(product) {
  const modal = document.getElementById('productModal');
  const modalContent = modal.querySelector('.modal-content');

  // Clear previous content
  modalContent.innerHTML = '';

  // Create elements for product details
  const productName = document.createElement('h2');
  productName.textContent = product.title;

  const productDescription = document.createElement('p');
  productDescription.textContent = product.description;

  // Create a close button
  const closeButton = document.createElement('span');
  closeButton.className = 'close-modal';
  closeButton.innerHTML = '&times;';

  // Add an event listener to close the modal when the close button is clicked
  closeButton.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  // Add elements to modal content
  modalContent.appendChild(closeButton);
  modalContent.appendChild(productName);
  modalContent.appendChild(productDescription);

  // Show the modal
  modal.style.display = 'block';
}

// Add event listener to product name
document.addEventListener('click', (event) => {
  if (event.target.classList.contains('title-name')) {
    const productId = event.target.getAttribute('data-product-id');
    const selectedProduct = products.find((product) => product._id === productId);
    createProductDetailsModal(selectedProduct);
  }
});

// Add an event listener to close the modal when clicking outside the modal content
window.addEventListener('click', (event) => {
  const modal = document.getElementById('productModal');
  if (event.target === modal) {
    modal.style.display = 'none';
  }
});




  // Call the function to initially display products
  fetchAndDisplayProducts();

//logout

  document.getElementById('logoutButton').addEventListener('click', async () => {
      try {
        // Send a request to the server to handle the logout
        const response = await fetch('http://localhost:5000/api/auth/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
        });

        if (response.ok) {
          // Logout successful, you might want to redirect to a login page or update the UI accordingly
          console.log('Logout successful');
          // Example: Redirect to the login page
          window.location.href = 'login.html';
        } else {
          // Handle errors if the logout request fails
          console.error('Logout failed');
        }
      } catch (error) {
        console.error('Error during logout:', error);
      }
    });




    function getAccessToken() {
      return localStorage.getItem('access_token');
  }

 // Logout button click event
document.getElementById('logoutButton').addEventListener('click', async function () {
    try {
        // Get the access token from localStorage
        const accessToken = localStorage.getItem('access_token');

        if (!accessToken) {
            console.error('Access token not found');
            return;
        }

        // Make a POST request to your logout endpoint
        const response = await fetch('http://localhost:5000/api/auth/logout', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json',
            },
        });

        if (response.ok) {
            // Remove the access token from localStorage
            localStorage.removeItem('access_token');

            alert('Logout successful');
            // Redirect to the login page or any other desired location
            window.location.href = '/login.html';
        } else {
            const errorData = await response.json();
            console.log('Logout failed:', errorData);
        }
    } catch (error) {
        console.error('An error occurred:', error);
    }
});

//nav logic

document.addEventListener('DOMContentLoaded', function () {
    // Check if the user is logged in
    const accessToken = localStorage.getItem('access_token');
    const userDropdown = document.getElementById('userDropdown');
    const loginLink = document.getElementById('loginLink');
    const logoutButton = document.getElementById('logoutButton');
    const profileLink = document.getElementById('profileLink');
    const registerLink = document.getElementById('registerLink');

    if (accessToken) {
        // User is logged in
        loginLink.style.display = 'none';
        registerLink.style.display = 'none';
        logoutButton.style.display = 'inline-block';
        profileLink.style.display = 'inline-block';
    } else {
        // User is not logged in
        loginLink.style.display = 'inline-block';
        registerLink.style.display = 'inline-block';
        logoutButton.style.display = 'none';
        profileLink.style.display = 'none';
    }

    // Logout button click event
    logoutButton.addEventListener('click', async function () {
        try {
            // Get the access token from localStorage
            const accessToken = localStorage.getItem('access_token');

            if (!accessToken) {
                console.error('Access token not found');
                return;
            }

            // Make a POST request to your logout endpoint
            const response = await fetch('http://localhost:5000/api/auth/logout', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
            });

            if (response.ok) {
                // Remove the access token from localStorage
                localStorage.removeItem('access_token');

                // Update the UI to show login and register links, hide logout and profile links
                loginLink.style.display = 'inline-block';
                registerLink.style.display = 'inline-block';
                logoutButton.style.display = 'none';
                profileLink.style.display = 'none';

                alert('Logout successful');
                // Redirect to the login page or any other desired location
                window.location.href = '/login.html';
            } else {
                const errorData = await response.json();
                console.log('Logout failed:', errorData);
            }
        } catch (error) {
            console.error('An error occurred:', error);
        }
    });
});  




</script>





  <!-- include jQuery -->
  <script src="js/jquery-1.11.3.min.js"></script>
  <!-- include jQuery -->
  <script src="js/plugins.js"></script>
  <!-- include jQuery -->
  <script src="js/jquery.main.js"></script>
</body>
</html>